# 项目全景需求说明书：PikPak Tinder-Swipe 自动化系统

## 一、 项目背景与核心痛点
本项目旨在为运行在“飞牛 OS (FNOS)”上的私有 NAS 构建一套丝滑的影视资源收集流水线。
1. **网络瓶颈**：国内直连 PikPak 速度极慢 (约 3MB/s)，且易断流。需要动态调度海外 VPS (Linode) 作为中转代理，以达到 500M 带宽满速 (50MB/s+)。
2. **筛选负担**：Telegram 资源频道信息爆炸，盲目采集会导致云端空间浪费。需要一个高效的“人机协作”筛选界面。
3. **流程琐碎**：从“看到链接”到“本地下载完成”涉及 5 个不同平台的切换，必须通过 API 级联实现全自动化。

## 二、 业务流程全生命周期 (The Lifecycle)
本系统由四个核心逻辑模块组成，NotebookLM 请务必理解其衔接逻辑：

### 1. 采集引擎 (The Collector)
* **任务**：监听 Telegram 指定频道。
* **逻辑**：提取磁力链/PikPak 链接，并抓取原始预览图。
* **数据存储**：将资源存入 SQLite 数据库，初始状态为 `PENDING`。

### 2. 筛选前端 (The Swipe H5/PWA)
* **交互设计**：仿 Tinder 风格。
    * **左滑 (Confirm)**：触发下载流程，状态变为 `CONFIRMED`。
    * **右滑 (Ignore)**：状态变为 `IGNORED`，从列表消失。
* **信息展示**：资源标题、大小、原始预览图。
* **实时看板**：展示当前 Linode 节点的运行状态、实时上下行速率、本月累计资费。

### 3. 编排引擎 (The Orchestrator) - **核心逻辑**
* **聚合下载策略 (Aggregation Strategy)**：
    * 当有任务变为 `CONFIRMED` 时，进入“窗口等待期”（默认 5 分钟）。
    * 窗口期内若有多个任务确认，则合并为一个下载批次。
    * 启动 Linode 实例，通过 cloud-init 部署 Hysteria2 代理。
* **代理分发**：
    * 实例就绪后，通过 RPC 更新 NAS 本地 Aria2 的 `all-proxy` 配置。
* **销毁策略**：
    * 监控 Aria2 任务状态，当该批次所有任务完成 (Status=Complete) 且 15 分钟内无新确认任务时，立即通过 API 销毁 Linode 实例以节省资费。

### 4. 下载引擎 (The Downloader)
* **PikPak 处理**：如果是文件夹，自动递归获取所有视频子文件的下载直链。
* **参数注入**：向 Aria2 推送任务时，必须注入 `User-Agent: Logos-Droid` 并开启 16 线程。

## 三、 技术栈约束
* **后端**: Python (FastAPI) + SQLite。
* **前端**: Vue3 + Vant UI (PWA 模式)。