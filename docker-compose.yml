version: "3.8"

services:
  # ============================================================
  # 单容器应用 (Backend + Collector + Frontend)
  # ============================================================
  app:
    build:
      context: .
      dockerfile: backend/Dockerfile
    container_name: swipe-app
    restart: unless-stopped
    volumes:
      - ./data:/data
      - ./sessions:/sessions
    env_file:
      - backend/.env
    ports:
      - "8000:8000"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

# ============================================================
# 说明:
#
# 1. 单容器架构
#    - 后端 FastAPI 服务
#    - Telegram 采集器（在 FastAPI lifespan 中启动）
#    - 前端静态文件（由 FastAPI 托管）
#
# 2. Aria2 服务需要单独部署（支持跨机器部署）
#    - 可以部署在 NAS 节点或远程服务器
#    - 通过 ARIA2_RPC_URL 配置连接地址
#    - 参考 aria2/docker-compose.yml 进行部署
#
# 3. 首次启动时需要进行 Telegram 登录验证
#    请使用 docker-compose logs -f app 查看验证码提示
#    会话文件会保存在 ./sessions 目录中
#
# 4. 所有配置通过 backend/.env 文件传入
#    请复制 backend/.env.example 为 backend/.env 并填入实际值
#
# 5. 访问地址
#    - 前端界面: http://localhost:8000
#    - API 文档: http://localhost:8000/docs
#    - 健康检查: http://localhost:8000/health
# ============================================================
